# MyEventLane API v1 Documentation

## Overview

The MyEventLane API provides programmatic access to event data and vendor operations. All API endpoints are versioned under `/api/v1/`.

## Authentication

### Public Endpoints

Public endpoints require no authentication but respect event visibility and state. Rate limiting is applied per IP address.

### Vendor Endpoints

Vendor endpoints require authentication using an API key. API keys are vendor-scoped and must be included in the `Authorization` header:

```
Authorization: Bearer {your_api_key}
```

To generate an API key:
1. Log in to your vendor dashboard
2. Navigate to Settings â†’ API Keys
3. Generate a new API key (displayed once - save it securely)

**Security Note:** API keys are hashed before storage. If you lose your key, you must regenerate it.

## Rate Limiting

### Public API
- **Limit:** 60 requests per minute per IP address
- **Headers:** 
  - `X-RateLimit-Remaining`: Number of requests remaining
  - `X-RateLimit-Reset`: Unix timestamp when limit resets

### Vendor API
- **Limit:** 1000 requests per hour per API key
- **Headers:** Same as public API

When rate limit is exceeded, you'll receive a `429 Too Many Requests` response.

## Response Format

### Success Response

```json
{
  "meta": {
    "version": "v1",
    "generated_at": 1234567890
  },
  "data": { ... }
}
```

### Error Response

```json
{
  "meta": {
    "version": "v1"
  },
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message"
  }
}
```

### Paginated Response

```json
{
  "meta": {
    "version": "v1",
    "generated_at": 1234567890,
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 100,
      "total_pages": 5
    }
  },
  "data": [ ... ]
}
```

## Endpoints

### Public Event API

#### List Events

```
GET /api/v1/events
```

**Query Parameters:**
- `q` (string): Search query (searches title and description)
- `category` (int|string): Filter by category (term ID or name)
- `from` (string): Filter events from this date (ISO 8601)
- `to` (string): Filter events until this date (ISO 8601)
- `city` (string): Filter by city (coming soon)
- `online` (boolean): Filter online events (coming soon)
- `page` (int): Page number (default: 1)
- `limit` (int): Items per page (default: 20, max: 100)

**Example:**

```bash
curl https://myeventlane.com/api/v1/events?q=music&category=1&page=1&limit=20
```

**Response:**

```json
{
  "meta": {
    "version": "v1",
    "generated_at": 1234567890,
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 45,
      "total_pages": 3
    }
  },
  "data": [
    {
      "id": 123,
      "title": "Summer Music Festival",
      "summary": "Annual outdoor music festival",
      "description": "Full description...",
      "start": "2024-07-15T14:00:00+00:00",
      "end": "2024-07-15T22:00:00+00:00",
      "location": {
        "venue_name": "Central Park",
        "address": {
          "address_line1": "123 Main St",
          "locality": "New York",
          "administrative_area": "NY",
          "postal_code": "10001",
          "country_code": "US"
        },
        "coordinates": {
          "latitude": 40.7829,
          "longitude": -73.9654
        }
      },
      "categories": [
        {
          "id": 1,
          "name": "Music",
          "slug": "music"
        }
      ],
      "image_url": "https://myeventlane.com/sites/default/files/event-image.jpg",
      "state": "live",
      "sales_window": {
        "start": "2024-06-01T00:00:00+00:00",
        "end": "2024-07-14T23:59:59+00:00"
      },
      "capacity": {
        "total": 1000,
        "remaining": 250,
        "unlimited": false
      },
      "cta_mode": "tickets",
      "external_url": null,
      "urls": {
        "canonical": "https://myeventlane.com/event/123",
        "calendar": {
          "ics": "https://myeventlane.com/event/123/ics",
          "google": "https://calendar.google.com/calendar/render?action=TEMPLATE&...",
          "outlook": "https://outlook.live.com/calendar/0/deeplink/compose?...",
          "apple": "https://myeventlane.com/event/123/ics"
        }
      }
    }
  ]
}
```

#### Get Event

```
GET /api/v1/events/{event_id}
```

**Path Parameters:**
- `event_id` (int): The event node ID

**Query Parameters:**
- `include_cancelled` (boolean): Include cancelled events (default: false)

**Example:**

```bash
curl https://myeventlane.com/api/v1/events/123
```

**Response:** Same format as single event object in list response.

### Vendor API

All vendor endpoints require authentication.

#### List Vendor Events

```
GET /api/v1/vendor/events
```

**Query Parameters:**
- `page` (int): Page number (default: 1)
- `limit` (int): Items per page (default: 20, max: 100)

**Example:**

```bash
curl -H "Authorization: Bearer {api_key}" \
  https://myeventlane.com/api/v1/vendor/events
```

**Response:** Same paginated format as public events list.

#### Get Vendor Event

```
GET /api/v1/vendor/events/{event_id}
```

**Response:** Same format as public event detail.

#### List Attendees

```
GET /api/v1/vendor/events/{event_id}/attendees
```

**Query Parameters:**
- `checked_in` (boolean): Filter by check-in status
- `q` (string): Search by name or email
- `page` (int): Page number (default: 1)
- `limit` (int): Items per page (default: 20, max: 100)

**Example:**

```bash
curl -H "Authorization: Bearer {api_key}" \
  https://myeventlane.com/api/v1/vendor/events/123/attendees?checked_in=true
```

**Response:**

```json
{
  "meta": {
    "version": "v1",
    "generated_at": 1234567890,
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 50,
      "total_pages": 3
    }
  },
  "data": [
    {
      "id": 456,
      "name": "John Doe",
      "email": "john@example.com",
      "ticket_code": "TKT-12345",
      "ticket_label": "Ticket",
      "checked_in": true,
      "checked_in_at": "2024-07-15T14:30:00+00:00",
      "source": "ticket"
    }
  ]
}
```

#### Check-In Attendee

```
POST /api/v1/vendor/events/{event_id}/attendees/{attendee_id}/checkin
```

**Request Body:**

```json
{
  "checked_in": true
}
```

**Response:** Updated attendee object.

#### Request CSV Export

```
POST /api/v1/vendor/events/{event_id}/exports/csv
```

**Response:**

```json
{
  "meta": {
    "version": "v1",
    "generated_at": 1234567890
  },
  "data": {
    "job_id": "export_123_1234567890",
    "status": "queued",
    "event_id": 123,
    "message": "Export job queued. Completion will be delivered via webhook."
  }
}
```

## Webhooks

Webhooks allow you to receive real-time notifications when events occur in MyEventLane.

### Event Types

- `event.updated` - Event details were updated
- `event.cancelled` - Event was cancelled
- `ticket.purchased` - Ticket purchase completed
- `ticket.refunded` - Ticket refund processed
- `rsvp.created` - New RSVP created
- `attendee.checked_in` - Attendee checked in
- `export.ready` - CSV export ready for download

### Webhook Payload

All webhooks are sent as POST requests with JSON payloads:

```json
{
  "event_id": 123,
  "vendor_id": 456,
  "timestamp": 1234567890,
  "type": "ticket.purchased",
  "data": {
    "order_id": 789,
    "attendee_id": 101,
    "ticket_code": "TKT-12345"
  }
}
```

### Webhook Signing

All webhooks are signed with HMAC-SHA256. The signature is included in the `X-MyEventLane-Signature` header.

**Verification Example (PHP):**

```php
$payload = file_get_contents('php://input');
$signature = $_SERVER['HTTP_X_MYEVENTLANE_SIGNATURE'] ?? '';
$secret = 'your_webhook_secret';

$expected_signature = hash_hmac('sha256', $payload, $secret);

if (!hash_equals($expected_signature, $signature)) {
  http_response_code(401);
  exit('Invalid signature');
}

// Process webhook
$data = json_decode($payload, true);
```

**Verification Example (Python):**

```python
import hmac
import hashlib

payload = request.data
signature = request.headers.get('X-MyEventLane-Signature')
secret = 'your_webhook_secret'

expected_signature = hmac.new(
    secret.encode(),
    payload,
    hashlib.sha256
).hexdigest()

if not hmac.compare_digest(expected_signature, signature):
    return 'Invalid signature', 401

# Process webhook
data = json.loads(payload)
```

### Webhook Delivery

- Webhooks are delivered asynchronously via queue
- Failed deliveries are retried with exponential backoff (1min, 5min, 15min, 1hr, 24hr)
- Maximum 5 retry attempts
- All delivery attempts are logged

### Managing Webhooks

Webhook subscriptions can be managed via the vendor dashboard or (in future) via API endpoints.

## Error Codes

- `UNAUTHORIZED` (401): Missing or invalid API key
- `FORBIDDEN` (403): Access denied (e.g., event not owned by vendor)
- `NOT_FOUND` (404): Resource not found
- `INVALID_REQUEST` (400): Invalid request parameters
- `RATE_LIMIT_EXCEEDED` (429): Rate limit exceeded
- `INTERNAL_ERROR` (500): Server error

## Best Practices

1. **Store API keys securely** - Never commit API keys to version control
2. **Implement exponential backoff** - When receiving 429 responses, wait before retrying
3. **Validate webhook signatures** - Always verify webhook signatures to ensure authenticity
4. **Handle idempotency** - Webhooks may be delivered multiple times; design your handlers to be idempotent
5. **Use pagination** - For large datasets, use pagination instead of requesting all data at once
6. **Cache responses** - Cache public event data to reduce API calls

## Support

For API support, contact: api@myeventlane.com
