// ==========================================================================
// Event Form - Vendor Style (Compact)
// ==========================================================================
// Minimal whitespace, high contrast, working conditionals.

@use 'sass:color';
@use '../tokens/colors';
@use '../tokens/typography';
@use '../tokens/spacing';
@use '../tokens/radii';
@use '../tokens/shadows';
@use '../tokens/breakpoints';

// ---------------------------------------------------------------------------
// Form Wrapper
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  display: flex;
  flex-direction: column;
  gap: spacing.mel-space(2);
  max-width: 100%;
  width: 100%;

  @include breakpoints.mel-break(md) {
    gap: spacing.mel-space(2);
  }
}

// ---------------------------------------------------------------------------
// Form Cards
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  .mel-form-card {
    background: #ffffff;
    border-radius: radii.$mel-radius-md;
    padding: spacing.mel-space(2) spacing.mel-space(3);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 1px solid #a0a0a0;
    width: 100%;

    @include breakpoints.mel-break(md) {
      padding: spacing.mel-space(3) spacing.mel-space(4);
    }

    &-highlight {
      border: 2px solid #6b5ce6;
      background: #ffffff;
    }
  }

  // Header
  .mel-form-header {
    margin-bottom: spacing.mel-space(2);
    padding-bottom: spacing.mel-space(1);
    border-bottom: 1px solid #d0d0d0;
  }

  .mel-form-title {
    font-size: typography.mel-font-size(lg);
    font-weight: typography.$mel-font-bold;
    color: #1a1a1a;
    margin: 0;
    line-height: typography.$mel-leading-tight;
  }

  // Content
  .mel-form-content {
    display: flex;
    flex-direction: column;
    gap: spacing.mel-space(2);

    @include breakpoints.mel-break(md) {
      gap: spacing.mel-space(2);
    }
  }

  // Form items - minimal spacing
  .form-item {
    margin-bottom: spacing.mel-space(2);
    position: relative; // Ensure z-index works for overlays
    z-index: 1;

    // Ensure entity reference autocomplete fields (taxonomy) are accessible
    &.form-type-entity-reference {
      z-index: 10;
      
      input.form-autocomplete {
        position: relative;
        z-index: 11;
      }
      
      .ui-autocomplete {
        z-index: 1000 !important;
      }
    }

    label {
      font-weight: typography.$mel-font-semibold;
      color: #2a2a2a;
      margin-bottom: spacing.mel-space(1);
      font-size: typography.mel-font-size(sm);
    }

    input[type="text"],
    input[type="email"],
    input[type="url"],
    input[type="number"],
    input[type="date"],
    input[type="time"],
    input[type="datetime-local"],
    textarea,
    select {
      width: 100%;
      font-size: typography.mel-font-size(base);
      padding: spacing.mel-space(2) spacing.mel-space(2);
      border: 1px solid #808080;
      border-radius: radii.$mel-radius-sm;
      background: #ffffff;
      color: #1a1a1a;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;

      &:focus {
        border-color: #6b5ce6;
        outline: none;
        box-shadow: 0 0 0 3px rgba(107, 92, 230, 0.15);
      }
    }

    textarea {
      min-height: 100px;
    }
  }

  // Help text - compact
  .description {
    margin-top: spacing.mel-space(1);
    font-size: typography.mel-font-size(sm);
    color: #3a3a3a;
    line-height: typography.$mel-leading-normal;
    padding: spacing.mel-space(2) spacing.mel-space(2);
    background: #f0f4ff;
    border-left: 2px solid #6b5ce6;
    border-radius: radii.$mel-radius-sm;
  }

  // Hide Drupal format help
  .filter-wrapper,
  .js-filter-wrapper,
  .mel-hide-format-help + .filter-wrapper,
  .mel-hide-format-help ~ .filter-wrapper {
    .filter-help,
    .filter-guidelines,
    .filter-guidelines-item {
      display: none !important;
    }
  }

  .form-item--text-format-wrapper .filter-wrapper {
    display: none !important;
  }
}

// ---------------------------------------------------------------------------
// Conditional Fields (#states)
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  // Let Drupal #states and conditional_fields handle visibility
  // Only hide if explicitly marked as force-hidden
  .mel-booking-rsvp,
  .mel-booking-paid,
  .mel-booking-external {
    transition: opacity 0.2s ease;
    overflow: hidden;

    // Force hide if data attribute says so (for JS override)
    &[data-force-hidden="true"] {
      display: none !important;
    }

    // Ensure visible when Drupal states makes them visible
    &.js-form-item {
      // Let conditional_fields handle it
    }
  }
}

// ---------------------------------------------------------------------------
// Sticky Footer
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  .mel-form-footer {
    position: sticky;
    bottom: 0;
    z-index: 50;
    background: #ffffff;
    border-top: 2px solid #c0c0c0;
    padding: spacing.mel-space(2) spacing.mel-space(3);
    margin: spacing.mel-space(3) calc(-1 * spacing.mel-space(3)) 0;
    box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: spacing.mel-space(2);

    @include breakpoints.mel-break(md) {
      padding: spacing.mel-space(2) spacing.mel-space(4);
      margin: spacing.mel-space(3) calc(-1 * spacing.mel-space(4)) 0;
    }

    .mel-btn-primary,
    .mel-btn-secondary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: spacing.mel-space(2) spacing.mel-space(4);
      min-height: 40px;
      font-family: typography.$mel-font-family;
      font-size: typography.mel-font-size(base);
      font-weight: typography.$mel-font-semibold;
      line-height: 1;
      border: 2px solid transparent;
      border-radius: radii.$mel-radius-md;
      cursor: pointer;
      transition: all 0.15s ease;

      &:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(107, 92, 230, 0.3);
      }
    }

    .mel-btn-primary {
      background-color: #ff6f61;
      color: #ffffff;
      border-color: #ff6f61;
      font-weight: typography.$mel-font-bold;

      &:hover {
        background-color: #e85a4d;
        border-color: #e85a4d;
      }
    }

    .mel-btn-secondary {
      background-color: #6b5ce6;
      color: #ffffff;
      border-color: #6b5ce6;

      &:hover {
        background-color: #5a4bd4;
        border-color: #5a4bd4;
      }
    }
  }
}

// ---------------------------------------------------------------------------
// Address Fields
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  .address-container,
  .myeventlane-location-address-widget,
  .field--name-field-location {
    .country,
    .form-item--name-country-code,
    .form-item-country-code,
    select[name*="country_code"],
    select[name*="[country_code]"] {
      display: none !important;
    }

    .myeventlane-location-address-search {
      width: 100%;
      padding: spacing.mel-space(2) spacing.mel-space(2);
      font-size: typography.mel-font-size(base);
      border: 1px solid #b0b0b0;
      border-radius: radii.$mel-radius-sm;
      margin-bottom: spacing.mel-space(2);
      background: #ffffff;
      position: relative;
      z-index: 10;

      &:focus {
        border-color: #6b5ce6;
        outline: none;
        box-shadow: 0 0 0 2px rgba(107, 92, 230, 0.1);
      }
    }

    // Ensure address fields are accessible
    input[name*="address_line1"],
    input[name*="address_line2"],
    input[name*="locality"],
    input[name*="postal_code"],
    input[name*="administrative_area"] {
      width: 100%;
      padding: spacing.mel-space(2) spacing.mel-space(2);
      font-size: typography.mel-font-size(base);
      border: 1px solid #b0b0b0;
      border-radius: radii.$mel-radius-sm;
      background: #ffffff;
      margin-bottom: spacing.mel-space(2);
    }
  }
}

// ---------------------------------------------------------------------------
  // Attendee Questions
  // ---------------------------------------------------------------------------

.mel-event-form-vendor {
  .mel-form-content {
    .paragraphs-subform {
      padding: spacing.mel-space(2);
      background: #f8f8f8;
      border: 1px solid #d0d0d0;
      border-radius: radii.$mel-radius-sm;
      margin-bottom: spacing.mel-space(2);
    }

    .paragraphs-add-wrapper {
      margin-top: spacing.mel-space(2);
      padding-top: spacing.mel-space(2);
      border-top: 1px solid #c0c0c0;
    }
  }
  
  // Taxonomy autocomplete fields - ensure they're accessible
  .form-item--name-field-category,
  .form-item--name-field-event-categories,
  .form-item--name-field-accessibility {
    position: relative;
    z-index: 10;
    
    .ui-autocomplete {
      z-index: 1000 !important;
      position: absolute !important;
    }
    
    input.form-autocomplete {
      z-index: 10;
      position: relative;
    }
  }
}

// ---------------------------------------------------------------------------
// Mobile
// ---------------------------------------------------------------------------

@media (max-width: 767px) {
  .mel-event-form-vendor {
    .mel-form-card {
      margin-left: calc(-1 * spacing.mel-space(3));
      margin-right: calc(-1 * spacing.mel-space(3));
      border-radius: 0;
      border-left: none;
      border-right: none;
      padding: spacing.mel-space(2);
    }

    .mel-form-footer {
      margin-left: calc(-1 * spacing.mel-space(3));
      margin-right: calc(-1 * spacing.mel-space(3));
      border-radius: 0;
      flex-direction: column;

      .mel-btn-primary,
      .mel-btn-secondary {
        width: 100%;
      }
    }
  }
}
