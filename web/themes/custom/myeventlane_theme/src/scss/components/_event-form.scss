// ==========================================================================
// Event Form Component
// ==========================================================================
// Mobile-first card-based layout for Event node add/edit forms.
// Matches MyEventLane V2 UX with grouped sections and sticky footer.

@use 'sass:color';
@use '../tokens/colors';
@use '../tokens/typography';
@use '../tokens/spacing';
@use '../tokens/radii';
@use '../tokens/shadows';
@use '../tokens/breakpoints';

// ---------------------------------------------------------------------------
// Form Wrapper
// ---------------------------------------------------------------------------

.mel-event-form {
  display: flex;
  flex-direction: column;
  gap: spacing.mel-space(5);
  max-width: 100%;

  @include breakpoints.mel-break(md) {
    gap: spacing.mel-space(6);
  }
}

// ---------------------------------------------------------------------------
// Form Groups and Cards
// ---------------------------------------------------------------------------

.mel-form-group {
  display: flex;
  flex-direction: column;
  width: 100%;
}

.mel-form-card {
  background: white;
  border-radius: radii.$mel-radius-xl;
  padding: spacing.mel-space(4);
  box-shadow: shadows.$mel-shadow-md;
  border: 2px solid colors.$mel-color-border-strong;
  transition: box-shadow 0.2s ease, border-color 0.2s ease;

  @include breakpoints.mel-break(md) {
    padding: spacing.mel-space(6) spacing.mel-space(7);
  }

  &:hover {
    box-shadow: shadows.$mel-shadow-lg;
    border-color: colors.$mel-color-primary;
  }

  // Highlight variant for booking configuration
  &--highlight {
    border: 3px solid colors.$mel-color-secondary;
    background: white;
    box-shadow: shadows.$mel-shadow-lg;

    .mel-form-section-title {
      color: colors.$mel-color-secondary;
    }
  }
}

// ---------------------------------------------------------------------------
// Section Header
// ---------------------------------------------------------------------------

.mel-form-section-header {
  margin-bottom: spacing.mel-space(4);
  padding-bottom: spacing.mel-space(3);
  border-bottom: 3px solid colors.$mel-color-border-strong;

  @include breakpoints.mel-break(md) {
    margin-bottom: spacing.mel-space(5);
    padding-bottom: spacing.mel-space(4);
  }
}

.mel-form-section-title {
  font-size: typography.mel-font-size(lg);
  font-weight: typography.$mel-font-bold;
  color: colors.$mel-color-text;
  margin: 0 0 spacing.mel-space(2) 0;
  display: flex;
  align-items: center;
  gap: spacing.mel-space(2);
  line-height: typography.$mel-leading-tight;

  @include breakpoints.mel-break(md) {
    font-size: typography.mel-font-size(xl);
    gap: spacing.mel-space(3);
  }
}

.mel-form-section-icon {
  font-size: typography.mel-font-size(xl);
  line-height: 1;
  filter: grayscale(0.2);

  @include breakpoints.mel-break(md) {
    font-size: typography.mel-font-size(2xl);
  }
}

.mel-form-section-description {
  font-size: typography.mel-font-size(sm);
  color: colors.$mel-color-text-muted;
  margin: 0;
  line-height: typography.$mel-leading-relaxed;
  max-width: 700px;
}

// ---------------------------------------------------------------------------
// Section Content
// ---------------------------------------------------------------------------

.mel-form-section-content {
  display: flex;
  flex-direction: column;
  gap: spacing.mel-space(4);

  // Full-width inputs on mobile
  .form-item {
    margin-bottom: spacing.mel-space(4);
    width: 100%;

    input[type="text"],
    input[type="email"],
    input[type="url"],
    input[type="number"],
    input[type="date"],
    input[type="time"],
    input[type="datetime-local"],
    textarea,
    select {
      width: 100%;
      max-width: 100%;
    }
  }

  // Two-column layout at md breakpoint and above
  @include breakpoints.mel-break(md) {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: spacing.mel-space(4);

    // Full-width items (like textarea, file uploads)
    .form-item--full-width,
    .form-item textarea,
    .form-item .form-managed-file {
      grid-column: 1 / -1;
    }
  }

  // Fieldset styling within sections
  fieldset {
    margin: 0;
    padding: spacing.mel-space(3);
    border: 1px solid colors.$mel-color-border;
    border-radius: radii.$mel-radius-md;
    background: colors.$mel-color-bg;

    @include breakpoints.mel-break(md) {
      padding: spacing.mel-space(4);
    }

    legend {
      font-size: typography.mel-font-size(base);
      font-weight: typography.$mel-font-semibold;
      color: colors.$mel-color-text;
      padding: 0 spacing.mel-space(2);
    }
  }

  // File upload fields
  .form-managed-file {
    .form-file {
      margin-bottom: spacing.mel-space(2);
    }

    .file {
      margin-top: spacing.mel-space(2);
      padding: spacing.mel-space(3);
      background: colors.$mel-color-bg;
      border-radius: radii.$mel-radius-md;
      font-size: typography.mel-font-size(sm);
    }
  }

  // Help text / descriptions
  .description {
    margin-top: spacing.mel-space(2);
    font-size: typography.mel-font-size(sm);
    color: colors.$mel-color-text;
    line-height: typography.$mel-leading-relaxed;
    padding: spacing.mel-space(3) spacing.mel-space(4);
    background: color.adjust(colors.$mel-color-primary, $alpha: -0.95);
    border-left: 4px solid colors.$mel-color-primary;
    border-radius: radii.$mel-radius-md;
    font-weight: typography.$mel-font-medium;
  }

  // Hide generic Drupal text format help text
  .filter-wrapper,
  .js-filter-wrapper,
  .mel-hide-format-help + .filter-wrapper,
  .mel-hide-format-help ~ .filter-wrapper {
    // Hide the "About text formats" link
    .filter-help {
      display: none !important;
    }
    
    // Hide format guidelines (the list of rules)
    .filter-guidelines,
    .filter-guidelines-item,
    .filter-guidelines-item__label,
    .filter-guidelines-item__description {
      display: none !important;
    }
  }
  
  // Hide text format guidelines that appear after textareas
  .form-item--text-format-wrapper {
    .filter-wrapper {
      display: none !important;
    }
  }

  // Disabled fields styling
  .mel-field-disabled {
    opacity: 0.7;
    background-color: colors.$mel-color-bg;
    cursor: not-allowed;

    input,
    select {
      background-color: colors.$mel-color-bg;
      cursor: not-allowed;
    }
  }
}

// ---------------------------------------------------------------------------
// States API Support
// ---------------------------------------------------------------------------

// Ensure Drupal #states API works correctly
.js-form-item {
  &[style*="display: none"] {
    display: none !important;
  }
}

// Smooth transitions for conditional fields
.mel-form-field-wrapper {
  transition: opacity 0.3s ease, max-height 0.3s ease, padding 0.3s ease;
  overflow: hidden;

  &[style*="display: none"] {
    display: none !important;
  }
}

// ---------------------------------------------------------------------------
// Sticky Footer
// ---------------------------------------------------------------------------

.mel-form-sticky-footer {
  position: sticky;
  bottom: 0;
  z-index: 50;
  background: white;
  border-top: 3px solid colors.$mel-color-border-strong;
  padding: spacing.mel-space(4);
  margin: spacing.mel-space(6) calc(-1 * spacing.mel-space(4)) 0;
  box-shadow: shadows.$mel-shadow-lg;
  display: flex;
  flex-direction: column;
  gap: spacing.mel-space(3);

  @include breakpoints.mel-break(md) {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    padding: spacing.mel-space(4) spacing.mel-space(6);
    margin: spacing.mel-space(6) calc(-1 * spacing.mel-space(6)) 0;
  }

  // Footer sections
  .mel-form-footer-left,
  .mel-form-footer-right {
    display: flex;
    gap: spacing.mel-space(3);
    width: 100%;

    @include breakpoints.mel-break(md) {
      width: auto;
    }
  }

  .mel-form-footer-left {
    @include breakpoints.mel-break(md) {
      order: 1;
    }
  }

  .mel-form-footer-right {
    @include breakpoints.mel-break(md) {
      order: 2;
    }
  }

  // Button styles
  .mel-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: spacing.mel-space(2);
    padding: spacing.mel-space(2) spacing.mel-space(4);
    min-height: 44px;
    font-family: typography.$mel-font-family;
    font-size: typography.mel-font-size(base);
    font-weight: typography.$mel-font-semibold;
    line-height: 1;
    text-decoration: none;
    white-space: nowrap;
    border: 2px solid transparent;
    border-radius: radii.$mel-radius-md;
    cursor: pointer;
    transition: all 0.15s ease;

    @include breakpoints.mel-break(md) {
      padding: spacing.mel-space(3) spacing.mel-space(6);
      min-height: 52px;
      font-size: typography.mel-font-size(md);
    }

    &:focus {
      outline: none;
    }

    &:focus-visible {
      @include colors.mel-focus-ring;
    }

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }
  }

  .mel-btn-primary {
    background-color: colors.$mel-color-primary;
    color: colors.$mel-color-text-inverse;
    border-color: colors.$mel-color-primary;
    font-weight: typography.$mel-font-bold;

    &:hover {
      background-color: colors.$mel-color-primary-hover;
      border-color: colors.$mel-color-primary-hover;
      transform: translateY(-1px);
      box-shadow: shadows.$mel-shadow-md;
    }

    &:active {
      background-color: colors.$mel-color-primary-active;
      border-color: colors.$mel-color-primary-active;
      transform: translateY(0);
    }
  }

  .mel-btn-secondary {
    background-color: colors.$mel-color-secondary;
    color: colors.$mel-color-text-inverse;
    border-color: colors.$mel-color-secondary;
    font-weight: typography.$mel-font-semibold;

    &:hover {
      background-color: colors.$mel-color-secondary-hover;
      border-color: colors.$mel-color-secondary-hover;
      transform: translateY(-1px);
      box-shadow: shadows.$mel-shadow-md;
    }

    &:active {
      background-color: colors.$mel-color-secondary-active;
      border-color: colors.$mel-color-secondary-active;
      transform: translateY(0);
    }
  }
}

// ---------------------------------------------------------------------------
// Booking Status Section
// ---------------------------------------------------------------------------

.mel-booking-status {
  margin-bottom: spacing.mel-space(6);
  padding: spacing.mel-space(4);
  background: colors.$mel-color-info-bg;
  border: 1px solid colors.$mel-color-info;
  border-radius: radii.$mel-radius-lg;
}

// ---------------------------------------------------------------------------
// Responsive Adjustments
// ---------------------------------------------------------------------------

// Ensure form doesn't overflow on mobile
@media (max-width: 767px) {
  .mel-event-form {
    padding: 0;
  }

  .mel-form-card {
    margin-left: calc(-1 * spacing.mel-space(4));
    margin-right: calc(-1 * spacing.mel-space(4));
    border-radius: 0;
    border-left: none;
    border-right: none;
  }

  .mel-form-sticky-footer {
    margin-left: calc(-1 * spacing.mel-space(4));
    margin-right: calc(-1 * spacing.mel-space(4));
    border-radius: 0;
  }
}
