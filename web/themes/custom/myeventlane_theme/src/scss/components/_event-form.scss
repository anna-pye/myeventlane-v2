// ==========================================================================
// Event Form - Vendor Style (Compact)
// ==========================================================================
// Minimal whitespace, high contrast, working conditionals.

@use 'sass:color';
@use '../tokens/colors';
@use '../tokens/typography';
@use '../tokens/spacing';
@use '../tokens/radii';
@use '../tokens/shadows';
@use '../tokens/breakpoints';

// ---------------------------------------------------------------------------
// Form Wrapper
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  display: flex;
  flex-direction: column;
  gap: spacing.mel-space(2);
  max-width: 100%;
  width: 100%;
  margin: 0 auto;

  @include breakpoints.mel-break(md) {
    gap: spacing.mel-space(2);
  }
}

// ---------------------------------------------------------------------------
// Form Cards
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  .mel-form-card {
    background: #ffffff;
    border-radius: radii.$mel-radius-lg;
    padding: spacing.mel-space(3) spacing.mel-space(4);
    box-shadow: 0 4px 12px rgba(107, 92, 230, 0.15), 0 2px 6px rgba(0, 0, 0, 0.1);
    border: 2px solid rgba(107, 92, 230, 0.3);
    width: 100%;
    transition: all 0.3s ease;

    &:hover {
      box-shadow: 0 6px 20px rgba(107, 92, 230, 0.2), 0 4px 10px rgba(0, 0, 0, 0.12);
      border-color: rgba(107, 92, 230, 0.5);
    }

    @include breakpoints.mel-break(md) {
      padding: spacing.mel-space(4) spacing.mel-space(5);
    }

    &-highlight {
      border: 3px solid #6b5ce6;
      background: #ffffff;
      box-shadow: 0 6px 24px rgba(107, 92, 230, 0.25), 0 4px 12px rgba(0, 0, 0, 0.15);
      
      &:hover {
        box-shadow: 0 8px 28px rgba(107, 92, 230, 0.35), 0 6px 16px rgba(0, 0, 0, 0.18);
        border-color: #5a4bd4;
      }
    }
  }

  // Header
  .mel-form-header {
    margin-bottom: spacing.mel-space(3);
    padding-bottom: spacing.mel-space(2);
    border-bottom: 3px solid rgba(107, 92, 230, 0.4);
    background: linear-gradient(90deg, rgba(107, 92, 230, 0.12) 0%, rgba(107, 92, 230, 0.05) 100%);
    padding: spacing.mel-space(2) spacing.mel-space(3);
    margin: calc(-1 * spacing.mel-space(3)) calc(-1 * spacing.mel-space(4)) spacing.mel-space(3);
    border-radius: radii.$mel-radius-md radii.$mel-radius-md 0 0;
  }

  .mel-form-title {
    font-size: typography.mel-font-size(xl);
    font-weight: typography.$mel-font-extrabold;
    color: #4a3a9e;
    margin: 0;
    line-height: typography.$mel-leading-tight;
  }

  // Content
  .mel-form-content {
    display: flex;
    flex-direction: column;
    gap: spacing.mel-space(2);

    @include breakpoints.mel-break(md) {
      gap: spacing.mel-space(2);
    }
  }

  // Form items - minimal spacing
  .form-item {
    margin-bottom: spacing.mel-space(2);
    position: relative; // Ensure z-index works for overlays
    z-index: 1;

    // Ensure entity reference autocomplete fields (taxonomy) are accessible
    &.form-type-entity-reference {
      z-index: 10;
      position: relative;
      
      input.form-autocomplete {
        position: relative;
        z-index: 11;
      }
      
      .ui-autocomplete {
        z-index: 10000 !important;
        position: absolute !important;
        max-height: 300px;
        overflow-y: auto;
        background: #ffffff;
        border: 1px solid #808080;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }
    }

    label {
      font-weight: typography.$mel-font-semibold;
      color: #2a2a2a;
      margin-bottom: spacing.mel-space(1);
      font-size: typography.mel-font-size(sm);
    }

    input[type="text"],
    input[type="email"],
    input[type="url"],
    input[type="number"],
    input[type="date"],
    input[type="time"],
    input[type="datetime-local"],
    textarea,
    select {
      width: 100%;
      font-size: typography.mel-font-size(base);
      padding: spacing.mel-space(3) spacing.mel-space(3);
      border: 2px solid rgba(107, 92, 230, 0.35);
      border-radius: radii.$mel-radius-md;
      background: #ffffff;
      color: #1a1a1a;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);

      &:hover {
        border-color: rgba(107, 92, 230, 0.6);
        box-shadow: 0 3px 8px rgba(107, 92, 230, 0.2);
      }

      &:focus {
        border-color: #6b5ce6;
        outline: none;
        box-shadow: 0 0 0 4px rgba(107, 92, 230, 0.25), 0 4px 12px rgba(107, 92, 230, 0.3);
        background: #ffffff;
      }
    }

    textarea {
      min-height: 100px;
    }
  }

  // Help text - compact
  .description {
    margin-top: spacing.mel-space(1);
    font-size: typography.mel-font-size(sm);
    color: #3d2b7e;
    line-height: typography.$mel-leading-normal;
    padding: spacing.mel-space(3) spacing.mel-space(3);
    background: #f0f4ff;
    border-left: 4px solid #6b5ce6;
    border-radius: radii.$mel-radius-md;
    box-shadow: 0 2px 6px rgba(107, 92, 230, 0.15);
  }

  // Hide Drupal format help
  .filter-wrapper,
  .js-filter-wrapper,
  .mel-hide-format-help + .filter-wrapper,
  .mel-hide-format-help ~ .filter-wrapper {
    .filter-help,
    .filter-guidelines,
    .filter-guidelines-item {
      display: none !important;
    }
  }

  .form-item--text-format-wrapper .filter-wrapper {
    display: none !important;
  }
}

// ---------------------------------------------------------------------------
// Conditional Fields (#states)
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  // Let Drupal #states and conditional_fields handle visibility completely
  // Don't interfere with their display logic - they use inline styles
  .mel-booking-rsvp,
  .mel-booking-paid,
  .mel-booking-external {
    // Smooth transitions when conditional_fields shows/hides
    transition: opacity 0.2s ease, max-height 0.3s ease;
    overflow: hidden;
    
    // Only force-hide if explicitly marked (for fallback JS)
    &[data-force-hidden="true"] {
      display: none !important;
    }
    
    // Let conditional_fields handle visibility via inline styles
    // Don't override their display property
  }
  
  // Ensure conditional_fields can work properly
  // Remove any CSS that might interfere with their inline style management
  .js-form-item {
    // Let conditional_fields handle visibility
  }
}

// ---------------------------------------------------------------------------
// Sticky Footer
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  .mel-form-footer {
    position: sticky;
    bottom: 0;
    z-index: 50;
    background: linear-gradient(180deg, #ffffff 0%, #f8f9ff 100%);
    border-top: 3px solid rgba(107, 92, 230, 0.2);
    padding: spacing.mel-space(3) spacing.mel-space(4);
    margin: spacing.mel-space(4) calc(-1 * spacing.mel-space(4)) 0;
    box-shadow: 0 -4px 12px rgba(107, 92, 230, 0.1), 0 -2px 6px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: spacing.mel-space(2);

    @include breakpoints.mel-break(md) {
      padding: spacing.mel-space(2) spacing.mel-space(4);
      margin: spacing.mel-space(3) calc(-1 * spacing.mel-space(4)) 0;
    }

    .mel-btn-primary,
    .mel-btn-secondary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: spacing.mel-space(2) spacing.mel-space(4);
      min-height: 40px;
      font-family: typography.$mel-font-family;
      font-size: typography.mel-font-size(base);
      font-weight: typography.$mel-font-semibold;
      line-height: 1;
      border: 2px solid transparent;
      border-radius: radii.$mel-radius-md;
      cursor: pointer;
      transition: all 0.15s ease;

      &:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(107, 92, 230, 0.3);
      }
    }

    .mel-btn-primary {
      background: linear-gradient(135deg, #ff6f61 0%, #ff8a7a 100%);
      color: #ffffff;
      border-color: #ff6f61;
      font-weight: typography.$mel-font-bold;
      box-shadow: 0 4px 12px rgba(255, 111, 97, 0.3);

      &:hover {
        background: linear-gradient(135deg, #e85a4d 0%, #ff6f61 100%);
        border-color: #e85a4d;
        box-shadow: 0 6px 16px rgba(255, 111, 97, 0.4);
        transform: translateY(-1px);
      }

      &:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(255, 111, 97, 0.3);
      }
    }

    .mel-btn-secondary {
      background: linear-gradient(135deg, #6b5ce6 0%, #8b7ee8 100%);
      color: #ffffff;
      border-color: #6b5ce6;
      box-shadow: 0 4px 12px rgba(107, 92, 230, 0.3);

      &:hover {
        background: linear-gradient(135deg, #5a4bd4 0%, #6b5ce6 100%);
        border-color: #5a4bd4;
        box-shadow: 0 6px 16px rgba(107, 92, 230, 0.4);
        transform: translateY(-1px);
      }

      &:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(107, 92, 230, 0.3);
      }
    }
  }
}

// ---------------------------------------------------------------------------
// Address Fields
// ---------------------------------------------------------------------------

.mel-event-form-vendor {
  .address-container,
  .myeventlane-location-address-widget,
  .field--name-field-location {
    .country,
    .form-item--name-country-code,
    .form-item-country-code,
    select[name*="country_code"],
    select[name*="[country_code]"] {
      display: none !important;
    }

    .myeventlane-location-address-search {
      width: 100%;
      padding: spacing.mel-space(2) spacing.mel-space(2);
      font-size: typography.mel-font-size(base);
      border: 1px solid #b0b0b0;
      border-radius: radii.$mel-radius-sm;
      margin-bottom: spacing.mel-space(2);
      background: #ffffff;
      position: relative;
      z-index: 10;

      &:focus {
        border-color: #6b5ce6;
        outline: none;
        box-shadow: 0 0 0 2px rgba(107, 92, 230, 0.1);
      }
    }

    // Ensure address fields are accessible
    input[name*="address_line1"],
    input[name*="address_line2"],
    input[name*="locality"],
    input[name*="postal_code"],
    input[name*="administrative_area"] {
      width: 100%;
      padding: spacing.mel-space(2) spacing.mel-space(2);
      font-size: typography.mel-font-size(base);
      border: 1px solid #b0b0b0;
      border-radius: radii.$mel-radius-sm;
      background: #ffffff;
      margin-bottom: spacing.mel-space(2);
    }
  }
}

// ---------------------------------------------------------------------------
  // Attendee Questions
  // ---------------------------------------------------------------------------

.mel-event-form-vendor {
  .mel-form-content {
    .paragraphs-subform {
      padding: spacing.mel-space(2);
      background: #f8f8f8;
      border: 1px solid #d0d0d0;
      border-radius: radii.$mel-radius-sm;
      margin-bottom: spacing.mel-space(2);
    }

    .paragraphs-add-wrapper {
      margin-top: spacing.mel-space(2);
      padding-top: spacing.mel-space(2);
      border-top: 1px solid #c0c0c0;
    }
  }
  
  // Taxonomy autocomplete fields - ensure they're accessible
  .form-item--name-field-category,
  .form-item--name-field-event-categories,
  .form-item--name-field-accessibility {
    position: relative;
    z-index: 10;
    
    .ui-autocomplete {
      z-index: 10000 !important;
      position: absolute !important;
      max-height: 300px;
      overflow-y: auto;
      background: #ffffff;
      border: 1px solid #808080;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    input.form-autocomplete {
      z-index: 11;
      position: relative;
    }
  }
}

// ---------------------------------------------------------------------------
// Mobile
// ---------------------------------------------------------------------------

@media (max-width: 767px) {
  .mel-event-form-vendor {
    .mel-form-card {
      margin-left: calc(-1 * spacing.mel-space(3));
      margin-right: calc(-1 * spacing.mel-space(3));
      border-radius: 0;
      border-left: none;
      border-right: none;
      padding: spacing.mel-space(2);
    }

    .mel-form-footer {
      margin-left: calc(-1 * spacing.mel-space(3));
      margin-right: calc(-1 * spacing.mel-space(3));
      border-radius: 0;
      flex-direction: column;

      .mel-btn-primary,
      .mel-btn-secondary {
        width: 100%;
      }
    }
  }
}
