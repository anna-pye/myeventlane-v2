{#
/**
 * @file
 * Theme override for event nodes in teaser view mode.
 *
 * Delegates to the canonical MyEventLane event card.
 */
#}

{% set start = node.field_event_start.value|default('') %}
{% set image_url = (node.field_event_image.entity) ? file_url(node.field_event_image.entity.uri.value) : '' %}

{% set ticket_type = 'rsvp' %}
{% set ticket_label = 'RSVP' %}
{% set raw_type = node.field_event_type.value|default('rsvp') %}
{% if raw_type in ['paid', 'both', 'external'] %}
  {% set ticket_type = 'tickets' %}
  {% set ticket_label = (raw_type == 'external') ? 'Get Tickets' : 'Tickets' %}
{% endif %}

{% set category = node.field_category.entity ? node.field_category.entity.label : '' %}
{% set category_slug = category|lower|replace({' ': '-', '&': 'and'}) %}

{% set location = node.field_venue_name.value|default('') %}
{% if not location and node.field_location and not node.field_location.isEmpty() %}
  {% set loc = node.field_location.value %}
  {% set location = loc.locality|default(loc.address_line1) %}
{% endif %}

{# Minimal accessibility: show one icon per term (fallback to ♿). #}
{% set accessibility = [] %}
{% if node.field_accessibility and not node.field_accessibility.isEmpty() %}
  {% for term_item in node.field_accessibility %}
    {% set accessibility = accessibility|merge(['♿']) %}
  {% endfor %}
{% endif %}

{# Check if we're in featured_events view context #}
{% set variant = mel_card_variant|default(null) %}

{% include '@myeventlane_theme/event/event-card.html.twig' with {
  title: label|default(node.label),
  url: url,
  image: image_url,
  date_day: start ? start|date('d') : '',
  date_month: start ? start|date('M') : '',
  date_full: start ? start|date('M j, Y') : '',
  location: location,
  category: category,
  category_slug: category_slug,
  ticket_type: ticket_type,
  ticket_label: ticket_label,
  accessibility: accessibility,
  variant: variant
} %}
