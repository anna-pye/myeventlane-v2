{#
/**
 * @file
 * Event card component with colorful placeholder backgrounds.
 *
 * Available variables:
 * - node: The event node entity.
 * - url: The event URL.
 * - label: The event title.
 * - variant: Card variant (default, compact, featured).
 */
#}

{% set variant = variant|default('default') %}
{% set card_classes = ['mel-event-card'] %}
{% if variant == 'featured' %}
  {% set card_classes = card_classes|merge(['mel-event-card--featured']) %}
{% elseif variant == 'compact' %}
  {% set card_classes = card_classes|merge(['mel-event-card--compact']) %}
{% endif %}

{# Pastel background colors - rotate based on node ID for variety #}
{% set bg_colors = ['lavender', 'mint', 'peach', 'sky', 'rose', 'yellow', 'coral'] %}
{% set bg_index = node.id|default(loop.index|default(1)) % 7 %}
{% set bg_color = bg_colors[bg_index] %}

{# Category-based emoji illustrations #}
{% set category_icons = {
  'music': 'ğŸ¸',
  'workshop': 'ğŸ¨',
  'community': 'ğŸ‘¥',
  'food': 'ğŸ•',
  'sports': 'âš½',
  'tech': 'ğŸ’»',
  'arts': 'ğŸ­',
  'wellness': 'ğŸ§˜',
  'education': 'ğŸ“š',
  'lgbtq': 'ğŸ³ï¸â€ğŸŒˆ',
  'default': 'ğŸ“…'
} %}

{% set category_name = node.field_category[0].entity.label|default('default')|lower %}
{% set card_icon = category_icons[category_name]|default(category_icons['default']) %}

<article class="{{ card_classes|join(' ') }}">

  {# Image or Placeholder #}
  {% set image = node.field_event_image.entity %}
  {% if image %}
    <div class="mel-event-card-image">
      {# Date Badge (floating) #}
      {% if node.field_event_start[0] is defined and node.field_event_start[0].value is not empty %}
        {% set ts = node.field_event_start[0].value|date('U') %}
        <div class="mel-event-card-date-badge">
          <span class="mel-event-card-date-month">{{ ts|date('M') }}</span>
          <span class="mel-event-card-date-day">{{ ts|date('d') }}</span>
        </div>
      {% endif %}
      <img 
        src="{{ file_url(image.uri.value) }}"
        alt="{{ image.alt }}"
        loading="lazy"
      >
    </div>
  {% else %}
    <div class="mel-event-card-image mel-event-card-image--placeholder mel-event-card-image--{{ bg_color }}">
      {# Date Badge (floating) #}
      {% if node.field_event_start[0] is defined and node.field_event_start[0].value is not empty %}
        {% set ts = node.field_event_start[0].value|date('U') %}
        <div class="mel-event-card-date-badge">
          <span class="mel-event-card-date-month">{{ ts|date('M') }}</span>
          <span class="mel-event-card-date-day">{{ ts|date('d') }}</span>
        </div>
      {% endif %}
      <span class="mel-event-card-illustration">{{ card_icon }}</span>
    </div>
  {% endif %}

  <div class="mel-event-card-body">

    {# Title #}
    <h3 class="mel-event-card-title">
      <a href="{{ url }}">{{ label }}</a>
    </h3>

    {# Meta Info #}
    <div class="mel-event-card-meta">
      {# Date #}
      {% if node.field_event_start[0] is defined and node.field_event_start[0].value is not empty %}
        {% set ts = node.field_event_start[0].value|date('U') %}
        <div class="mel-event-card-meta-item">
          <span class="mel-event-card-meta-icon">ğŸ“…</span>
          <span>{{ ts|date('M d, Y') }}</span>
        </div>
      {% endif %}

      {# Location #}
      {% if node.field_location.value is not empty %}
        {% set loc = node.field_location.value %}
        <div class="mel-event-card-meta-item">
          <span class="mel-event-card-meta-icon">ğŸ“</span>
          <span>{{ loc.locality|default(loc.address_line1) }}</span>
        </div>
      {% endif %}
    </div>

    {# Footer with Price and CTA #}
    <div class="mel-event-card-footer">
      {# Price #}
      {% if node.field_event_price is defined and node.field_event_price.value is not empty %}
        <span class="mel-event-card-price">
          From <strong>${{ node.field_event_price.value|number_format(0) }}</strong>
        </span>
      {% else %}
        <span class="mel-event-card-price mel-event-card-price--free">Free</span>
      {% endif %}

      {# CTA Button #}
      <div class="mel-event-card-cta">
        {% if node.field_rsvp_enabled.value %}
          <a href="{{ url }}#rsvp" class="mel-btn mel-btn-primary mel-btn-sm mel-btn-pill">RSVP</a>
        {% elseif node.field_tickets_enabled.value %}
          <a href="{{ url }}#tickets" class="mel-btn mel-btn-primary mel-btn-sm mel-btn-pill">Tickets</a>
        {% endif %}
      </div>
    </div>

  </div>

</article>
