{#
/**
 * @file
 * MEL Event full node template.
 *
 * Driven by Manage Display. We only provide layout + computed variables.
 */
#}

<article{{ attributes.addClass('mel-event') }}>
  {% if content.field_event_image %}
    <header class="mel-event__hero">
      <div class="mel-event__hero-media">
        {{ content.field_event_image }}
      </div>

      <div class="mel-event__hero-overlay">
        <div class="mel-container">
          <h1 class="mel-event__title">{{ label }}</h1>

          <div class="mel-event__meta">
            {% if content.field_category %}
              <div class="mel-event__chips mel-event__chips--category">
                {{ content.field_category }}
              </div>
            {% endif %}

            {% if content.field_tags %}
              <div class="mel-event__chips mel-event__chips--tags">
                {{ content.field_tags }}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </header>
  {% endif %}

  <div class="mel-container mel-event__layout">
    <div class="mel-event__main">
      {% if content.body %}
        <section class="mel-card mel-event__section">
          <h2 class="mel-h2">About this event</h2>
          {{ content.body }}
        </section>
      {% endif %}

      {% if content.field_event_video is defined and content.field_event_video %}
        <section class="mel-card mel-event__section">
          <h2 class="mel-h2">Video</h2>
          {{ content.field_event_video }}
        </section>
      {% endif %}

      <section class="mel-card mel-event__section">
        <h2 class="mel-h2">Event info</h2>

        {% if content.field_refund_policy %}
          <details class="mel-accordion">
            <summary class="mel-accordion__summary">Refund policy</summary>
            <div class="mel-accordion__body">
              {{ content.field_refund_policy }}
            </div>
          </details>
        {% endif %}

        {% set has_accessibility =
          (content.field_accessibility is defined and content.field_accessibility) or
          (content.field_accessibility_entry is defined and content.field_accessibility_entry) or
          (content.field_accessibility_contact is defined and content.field_accessibility_contact) or
          (content.field_accessibility_directions is defined and content.field_accessibility_directions) or
          (content.field_accessibility_parking is defined and content.field_accessibility_parking)
        %}

        {% if has_accessibility %}
          <details class="mel-accordion">
            <summary class="mel-accordion__summary">Accessibility</summary>
            <div class="mel-accordion__body">
              {% if content.field_accessibility is defined %}{{ content.field_accessibility }}{% endif %}
              {% if content.field_accessibility_entry is defined %}{{ content.field_accessibility_entry }}{% endif %}
              {% if content.field_accessibility_contact is defined %}{{ content.field_accessibility_contact }}{% endif %}
              {% if content.field_accessibility_directions is defined %}{{ content.field_accessibility_directions }}{% endif %}
              {% if content.field_accessibility_parking is defined %}{{ content.field_accessibility_parking }}{% endif %}
            </div>
          </details>
        {% endif %}
      </section>

      {% if mel_host_block %}
        <section class="mel-event__below">
          {{ mel_host_block }}
        </section>
      {% endif %}

      {% if mel_more_from_host_block %}
        <section class="mel-event__below">
          {{ mel_more_from_host_block }}
        </section>
      {% endif %}

      {% if mel_trending_block %}
        <section class="mel-event__below">
          {{ mel_trending_block }}
        </section>
      {% endif %}
    </div>

    <aside class="mel-event__sidebar">
      <div class="mel-sticky">
        <div class="mel-card mel-event__cta">
          {% if mel_registration_badge %}
            <div class="mel-badge">{{ mel_registration_badge }}</div>
          {% endif %}

          {% if mel_ticket_cta %}
            <div class="mel-event__cta-action">
              {{ mel_ticket_cta }}
            </div>
          {% endif %}

          <div class="mel-event__sidebar-meta">
            {% if content.field_event_start or content.field_event_end %}
              <div class="mel-event__sidebar-item">
                <strong>Date &amp; time</strong>
                <div class="mel-small">
                  {% if content.field_event_start %}{{ content.field_event_start }}{% endif %}
                  {% if content.field_event_end %}{{ content.field_event_end }}{% endif %}
                </div>
              </div>
            {% endif %}

            {% if content.field_venue_name or content.field_location %}
              <div class="mel-event__sidebar-item">
                <strong>Location</strong>
                <div class="mel-small">
                  {% if content.field_venue_name %}{{ content.field_venue_name }}{% endif %}
                  {% if content.field_location %}{{ content.field_location }}{% endif %}
                </div>
              </div>
            {% endif %}

            {% if mel_capacity_text %}
              <div class="mel-event__sidebar-item">
                <strong>Capacity</strong>
                <div class="mel-small">{{ mel_capacity_text }}</div>
              </div>
            {% endif %}

            {% if mel_calendar_links %}
              <div class="mel-event__sidebar-item">
                <strong>Add to calendar</strong>
                <div class="mel-links-inline">
                  {{ mel_calendar_links }}
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </aside>
  </div>
</article>
