let t={checkbox:null,toggle:null,mobileNav:null,closeBtn:null,overlay:null,initialized:!1};function y(){if(t.initialized)return;const o=document.querySelector("#mel-nav-toggle-checkbox");if(t.toggle=document.querySelector(".mel-nav-toggle"),t.mobileNav=document.querySelector(".mel-nav-mobile-wrapper"),t.closeBtn=document.querySelector(".mel-nav-mobile-close"),t.overlay=document.querySelector(".mel-nav-overlay"),!o||!t.toggle||!t.mobileNav){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):setTimeout(y,100);return}t.checkbox=o,t.initialized=!0,t.checkbox.addEventListener("change",function(){if(t.checkbox.checked){s=document.activeElement,t.mobileNav.classList.add("is-open"),t.overlay&&t.overlay.classList.add("is-visible"),t.toggle.setAttribute("aria-expanded","true"),t.mobileNav.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const e=t.mobileNav.querySelector("a, button");e&&setTimeout(()=>e.focus(),100),document.addEventListener("keydown",m)}else t.mobileNav.classList.remove("is-open"),t.overlay&&t.overlay.classList.remove("is-visible"),t.toggle.setAttribute("aria-expanded","false"),t.mobileNav.setAttribute("aria-hidden","true"),document.body.style.overflow="",document.removeEventListener("keydown",m),s&&typeof s.focus=="function"?setTimeout(()=>s.focus(),100):t.toggle.focus()});const d=()=>{const e=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", ");return Array.from(t.mobileNav.querySelectorAll(e))};let s=null;function m(e){if(!t.checkbox.checked)return;const n=d();if(n.length===0)return;const i=n[0],l=n[n.length-1];e.key==="Tab"&&(e.shiftKey?document.activeElement===i&&(e.preventDefault(),l.focus()):document.activeElement===l&&(e.preventDefault(),i.focus()))}function u(){t.checkbox.checked=!1,t.mobileNav.classList.remove("is-open"),t.overlay&&t.overlay.classList.remove("is-visible"),t.toggle.setAttribute("aria-expanded","false"),t.mobileNav.setAttribute("aria-hidden","true"),document.body.style.overflow="",document.removeEventListener("keydown",m),s&&typeof s.focus=="function"?setTimeout(()=>s.focus(),100):t.toggle.focus()}document.addEventListener("click",function(e){if(e.target.closest(".mel-nav-mobile-close")||e.target.closest("[data-nav-close]")){e.preventDefault(),e.stopPropagation(),u();return}if(e.target===t.overlay||e.target.classList.contains("mel-nav-overlay")){e.preventDefault(),e.stopPropagation(),u();return}},!0),document.addEventListener("keydown",function(e){e.key==="Escape"&&t.checkbox.checked&&u()});const c=window.matchMedia("(min-width: 768px)");c.addEventListener?c.addEventListener("change",function(e){e.matches&&t.checkbox.checked&&u()}):c.addListener(function(e){e.matches&&t.checkbox.checked&&u()})}(function(o){const d=new WeakMap;o.behaviors.eventFormConditionalFields={attach:function(s,m){const u=s.querySelector('form.node-event-form, form[id*="node-event-form"], .mel-event-form-wrapper form');if(!u)return;const c=['select[name="field_event_type[0][value]"]','select[data-booking-type-select="true"]','select[name*="field_event_type"][name*="value"]','.mel-form-content select[name*="field_event_type"]','.booking_config select[name*="field_event_type"]','select[name*="field_event_type"]'];let e=null;for(let a=0;a<c.length;a++)if(e=s.querySelector(c[a]),e){console.log("Event form: Found select with selector:",c[a]);break}if(!e){u&&console.warn("Event form: Could not find field_event_type select element");return}if(typeof o<"u"&&o.behaviors&&setTimeout(function(){if(typeof o.states<"u"&&o.states.trigger&&o.states.trigger(e,"change"),typeof jQuery<"u"&&jQuery(e).length)jQuery(e).trigger("change").trigger("input");else if(e){const a=new Event("change",{bubbles:!0,cancelable:!0}),r=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(a),e.dispatchEvent(r)}},300),d.has(e))return;const n=s.querySelector(".mel-booking-rsvp"),i=s.querySelector(".mel-booking-paid"),l=s.querySelector(".mel-booking-external");console.log("Event form: Containers found - RSVP:",!!n,"Paid:",!!i,"External:",!!l);const b=function(){const a=e.value;if(console.log("Event form: Fallback visibility check for value:",a),n){const r=window.getComputedStyle(n),f=r.display!=="none"&&r.visibility!=="hidden",v=a==="rsvp"||a==="both";v&&!f?(console.warn("Event form: Fallback - showing RSVP fields"),n.style.display="block",n.removeAttribute("data-force-hidden")):!v&&f&&!n.hasAttribute("data-conditional-fields-processed")&&(n.style.display="none",n.setAttribute("data-force-hidden","true"))}if(i){const r=window.getComputedStyle(i),f=r.display!=="none"&&r.visibility!=="hidden",v=a==="paid"||a==="both";v&&!f?(console.warn("Event form: Fallback - showing Paid fields"),i.style.display="block",i.removeAttribute("data-force-hidden")):!v&&f&&!i.hasAttribute("data-conditional-fields-processed")&&(i.style.display="none",i.setAttribute("data-force-hidden","true"))}if(l){const r=window.getComputedStyle(l),f=r.display!=="none"&&r.visibility!=="hidden",v=a==="external";v&&!f?(console.warn("Event form: Fallback - showing External fields"),l.style.display="block",l.removeAttribute("data-force-hidden")):!v&&f&&!l.hasAttribute("data-conditional-fields-processed")&&(l.style.display="none",l.setAttribute("data-force-hidden","true"))}};setTimeout(function(){n&&!n.hasAttribute("data-conditional-fields-processed")&&b(),i&&!i.hasAttribute("data-conditional-fields-processed")&&b(),l&&!l.hasAttribute("data-conditional-fields-processed")&&b()},500),e.addEventListener("change",function(){typeof o.states<"u"&&o.states.trigger&&o.states.trigger(e,"change"),setTimeout(function(){b()},150)});let h=null;(n||i||l)&&(h=setInterval(function(){e.value&&(n&&n.hasAttribute("data-force-hidden")&&!n.hasAttribute("data-conditional-fields-processed")||i&&i.hasAttribute("data-force-hidden")&&!i.hasAttribute("data-conditional-fields-processed")||l&&l.hasAttribute("data-force-hidden")&&!l.hasAttribute("data-conditional-fields-processed"))&&(console.warn("Event form: Conditional fields not working, using fallback"),b())},3e3),d.set(e,h))},detach:function(s,m,u){const c=['select[name="field_event_type[0][value]"]','select[name*="field_event_type"][name*="value"]','select[name*="field_event_type"]'];for(let e=0;e<c.length;e++){const n=s.querySelector(c[e]);if(n&&d.has(n)){const i=d.get(n);i&&(clearInterval(i),d.delete(n),console.log("Event form: Cleaned up interval for select element"));break}}}}})(Drupal);(function(){function o(d){y()}typeof Drupal<"u"&&Drupal.behaviors&&(Drupal.behaviors.myeventlaneTheme={attach:function(d,s){o()}}),document.readyState==="loading"?(document.addEventListener("DOMContentLoaded",function(){o()}),setTimeout(function(){o()},0)):o(),setTimeout(function(){o()},500)})();
