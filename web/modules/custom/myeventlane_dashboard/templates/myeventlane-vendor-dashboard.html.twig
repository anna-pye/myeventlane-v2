{#
/**
 * @file
 * Template for the MyEventLane vendor dashboard.
 *
 * Available variables:
 * - welcome_message: Personalized welcome message.
 * - upcoming_events: Array of upcoming event data.
 * - past_events: Array of past event data.
 * - quick_links: Array of quick action links.
 */
#}
<div class="mel-dashboard-wrapper mel-dashboard-wrapper--vendor">

  <h1 class="mel-dashboard-title">{{ 'Vendor Dashboard'|t }}</h1>

  {# Stripe Connection Status Banner - Prominent at top #}
  {% if stripe_status %}
    <div class="mel-stripe-banner mel-stripe-banner--{% if stripe_status.connected %}connected{% else %}unconnected{% endif %}" role="alert" style="margin-bottom: 2rem; padding: 1.25rem 1.75rem; border-radius: 10px; display: flex; align-items: center; gap: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); {% if stripe_status.connected %}background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border: 2px solid #28a745;{% else %}background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border: 2px solid #ffc107;{% endif %}">
      <div class="mel-stripe-banner__icon" style="flex-shrink: 0;">
        {% if stripe_status.connected %}
          <div style="width: 48px; height: 48px; border-radius: 50%; background-color: #28a745; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: white;">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" fill="currentColor"/>
            </svg>
          </div>
        {% else %}
          <div style="width: 48px; height: 48px; border-radius: 50%; background-color: #ffc107; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: white;">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="currentColor"/>
            </svg>
          </div>
        {% endif %}
      </div>
      <div class="mel-stripe-banner__text" style="flex: 1;">
        {% if stripe_status.connected %}
          <div style="font-weight: 700; font-size: 1.25rem; margin-bottom: 0.5rem; color: #155724; display: flex; align-items: center; gap: 0.5rem;">
            <span>{{ '✓ Stripe Account Linked'|t }}</span>
            {% if stripe_status.status_label %}
              <span class="mel-badge mel-badge--success" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">{{ stripe_status.status_label }}</span>
            {% endif %}
          </div>
          <div style="color: #155724; font-size: 1rem; line-height: 1.5;">
            {{ stripe_status.status_message }}
          </div>
        {% else %}
          <div style="font-weight: 700; font-size: 1.25rem; margin-bottom: 0.5rem; color: #856404; display: flex; align-items: center; gap: 0.5rem;">
            <span>{{ '⚠ Stripe Account Not Connected'|t }}</span>
            {% if stripe_status.status_label %}
              <span class="mel-badge mel-badge--warning" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">{{ stripe_status.status_label }}</span>
            {% endif %}
          </div>
          <div style="color: #856404; font-size: 1rem; line-height: 1.5;">
            {{ stripe_status.status_message }}
          </div>
        {% endif %}
      </div>
      <div class="mel-stripe-banner__actions" style="flex-shrink: 0; display: flex; flex-direction: column; gap: 0.5rem;">
        {% if stripe_status.connected %}
          {% if stripe_status.manage_url %}
            <a href="{{ stripe_status.manage_url }}" class="mel-btn mel-btn-primary" target="_blank" rel="noopener" style="min-width: 140px; text-align: center; font-weight: 600;">
              {{ 'Manage Account'|t }}
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-left: 0.5rem; display: inline-block; vertical-align: middle;">
                <path d="M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.11 0-2 .89-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1zM14 4c0 .55.45 1 1 1h2.59l-9.13 9.13c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V4c0-.55-.45-1-1-1h-5c-.55 0-1 .45-1 1z" fill="currentColor"/>
              </svg>
            </a>
          {% endif %}
          <a href="{{ stripe_status.connect_url }}" class="mel-btn mel-btn-secondary" style="min-width: 140px; text-align: center;">
            {{ 'Reconnect'|t }}
          </a>
        {% else %}
          {% if stripe_status.connect_url %}
            <a href="{{ stripe_status.connect_url }}" class="mel-btn mel-btn-primary" style="min-width: 160px; text-align: center; font-weight: 600; font-size: 1.05rem; padding: 0.75rem 1.5rem;">
              {{ 'Connect Stripe Now'|t }}
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-left: 0.5rem; display: inline-block; vertical-align: middle;">
                <path d="M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.11 0-2 .89-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1zM14 4c0 .55.45 1 1 1h2.59l-9.13 9.13c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V4c0-.55-.45-1-1-1h-5c-.55 0-1 .45-1 1z" fill="currentColor"/>
              </svg>
            </a>
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% endif %}


  {# Welcome message #}
  {% if welcome_message %}
    <div class="mel-dashboard-welcome">
      <p>{{ welcome_message }}</p>
    </div>
  {% endif %}


  {# Payment Setup Section - Detailed Stripe Status #}
  {% if stripe_status %}
    <section class="mel-dashboard-section" aria-labelledby="stripe-status-title">
      <h2 id="stripe-status-title" class="mel-section-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
        </svg>
        {{ 'Payment Setup'|t }}
      </h2>
      <div class="mel-card" style="border-left: 4px solid {% if stripe_status.connected %}#28a745{% else %}#ffc107{% endif %};">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
          <div>
            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.25rem; font-weight: 600;">
              {% if stripe_status.connected %}
                <span style="color: #28a745;">{{ '✓ Stripe Account Active'|t }}</span>
              {% else %}
                <span style="color: #856404;">{{ '⚠ Action Required: Connect Stripe'|t }}</span>
              {% endif %}
            </h3>
            <p style="margin: 0; color: #666; font-size: 0.95rem;">
              {{ stripe_status.status_message }}
            </p>
          </div>
          <div>
            {% if stripe_status.status_label %}
              <span class="mel-badge mel-badge--{% if stripe_status.connected %}success{% else %}warning{% endif %}" style="font-size: 0.9rem; padding: 0.5rem 1rem;">{{ stripe_status.status_label }}</span>
            {% endif %}
          </div>
        </div>
        
        <div class="mel-stripe-status__actions" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem;">
          {% if stripe_status.connected %}
            {% if stripe_status.manage_url %}
              <a href="{{ stripe_status.manage_url }}" class="mel-btn mel-btn-primary" target="_blank" rel="noopener" style="flex: 1; min-width: 180px; text-align: center; font-weight: 600;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 0.5rem; display: inline-block; vertical-align: middle;">
                  <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" fill="currentColor"/>
                </svg>
                {{ 'Manage Stripe Account'|t }}
              </a>
            {% endif %}
            <a href="{{ stripe_status.connect_url }}" class="mel-btn mel-btn-secondary" style="flex: 1; min-width: 180px; text-align: center;">
              {{ 'Reconnect Stripe'|t }}
            </a>
          {% else %}
            {% if stripe_status.connect_url %}
              <a href="{{ stripe_status.connect_url }}" class="mel-btn mel-btn-primary" style="flex: 1; min-width: 200px; text-align: center; font-weight: 600; font-size: 1.05rem; padding: 0.875rem 1.75rem;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 0.5rem; display: inline-block; vertical-align: middle;">
                  <path d="M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.11 0-2 .89-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1zM14 4c0 .55.45 1 1 1h2.59l-9.13 9.13c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V4c0-.55-.45-1-1-1h-5c-.55 0-1 .45-1 1z" fill="currentColor"/>
                </svg>
                {{ 'Connect Stripe Account'|t }}
              </a>
            {% endif %}
          {% endif %}
        </div>
        
        {% if stripe_status.account_id %}
          <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e0e0e0;">
            <p style="margin: 0 0 0.5rem 0; font-size: 0.875rem; color: #666; font-weight: 600;">{{ 'Stripe Account ID:'|t }}</p>
            <code style="background-color: #f5f5f5; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 0.875rem; display: inline-block; color: #333;">{{ stripe_status.account_id }}</code>
          </div>
        {% endif %}
      </div>
    </section>
  {% endif %}


  {# Quick actions #}
  {% if quick_links %}
    <section class="mel-dashboard-section" aria-labelledby="quick-actions-title">
      <h2 id="quick-actions-title" class="mel-section-title">{{ 'Quick Actions'|t }}</h2>
      <div class="mel-dashboard-grid">
        {% for link in quick_links %}
          <div class="mel-card">
            <h3>{{ link.title }}</h3>
            <a href="{{ link.url }}" class="mel-btn mel-btn-primary">{{ link.title }}</a>
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# Upcoming events #}
  {% if upcoming_events is not empty %}
    <section class="mel-dashboard-section" aria-labelledby="upcoming-events-title">
      <h2 id="upcoming-events-title" class="mel-section-title">{{ 'Upcoming Events'|t }}</h2>
      <div class="mel-events-table">
        <table class="mel-table">
          <thead>
            <tr>
              <th>{{ 'Event'|t }}</th>
              <th>{{ 'Date'|t }}</th>
              <th>{{ 'Mode'|t }}</th>
              <th>{{ 'Boost'|t }}</th>
              <th>{{ 'RSVPs'|t }}</th>
              <th>{{ 'Tickets'|t }}</th>
              <th>{{ 'Revenue'|t }}</th>
              <th>{{ 'Donations'|t }}</th>
              <th>{{ 'Actions'|t }}</th>
            </tr>
          </thead>
          <tbody>
            {% for event in upcoming_events %}
              <tr>
                <td><a href="{{ event.url }}">{{ event.title }}</a></td>
                <td>
                  {% if event.start_date %}
                    <time>{{ event.start_date }}{% if event.start_time %} {{ event.start_time }}{% endif %}</time>
                  {% else %}
                    <span class="mel-muted">{{ 'No date'|t }}</span>
                  {% endif %}
                </td>
                <td>
                  <span class="mel-badge mel-badge--{{ event.event_mode }}">
                    {% if event.event_mode == 'rsvp' %}
                      {{ 'RSVP'|t }}
                    {% elseif event.event_mode == 'paid' %}
                      {{ 'Paid'|t }}
                    {% elseif event.event_mode == 'both' %}
                      {{ 'Both'|t }}
                    {% else %}
                      {{ event.event_mode|capitalize }}
                    {% endif %}
                  </span>
                </td>
                <td>
                  {% if event.boost_status %}
                    {% if event.boost_status.is_boosted %}
                      <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                        <span class="mel-badge mel-badge--success" style="align-self: flex-start;">{{ 'Boosted'|t }}</span>
                        {% if event.boost_status.expires_date %}
                          <div class="mel-muted" style="font-size: 0.875rem;">
                            {{ 'Expires: @date'|t({'@date': event.boost_status.expires_date}) }}
                          </div>
                        {% endif %}
                        {% if event.boost_status.boost_url %}
                          <a href="{{ event.boost_status.boost_url }}" class="mel-btn mel-btn-small" style="margin-top: 0.25rem; align-self: flex-start;">{{ 'Extend'|t }}</a>
                        {% endif %}
                      </div>
                    {% elseif event.boost_status.is_expired %}
                      <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                        <span class="mel-badge mel-badge--warning" style="align-self: flex-start;">{{ 'Expired'|t }}</span>
                        {% if event.boost_status.boost_url %}
                          <a href="{{ event.boost_status.boost_url }}" class="mel-btn mel-btn-small" style="margin-top: 0.25rem; align-self: flex-start;">{{ 'Boost Again'|t }}</a>
                        {% endif %}
                      </div>
                    {% else %}
                      {% if event.boost_status.boost_url %}
                        <a href="{{ event.boost_status.boost_url }}" class="mel-btn mel-btn-small mel-btn-primary">{{ 'Boost Event'|t }}</a>
                      {% endif %}
                    {% endif %}
                  {% endif %}
                </td>
                <td>
                  {% if event.rsvp_count > 0 %}
                    <strong>{{ event.rsvp_count }}</strong>
                    {% if event.waitlist_count > 0 %}
                      <span class="mel-muted" style="font-size: 0.875rem;">({{ event.waitlist_count }} waitlist)</span>
                    {% endif %}
                  {% else %}
                    <span class="mel-muted">0</span>
                  {% endif %}
                </td>
                <td>
                  {% if event.attendee_count > 0 %}
                    <strong>{{ event.attendee_count }}</strong>
                  {% else %}
                    <span class="mel-muted">0</span>
                  {% endif %}
                </td>
                <td>
                  {% if event.revenue > 0 %}
                    ${{ event.revenue|number_format(2) }}
                  {% else %}
                    <span class="mel-muted">$0.00</span>
                  {% endif %}
                </td>
                <td>
                  {% if event.donation_total > 0 %}
                    <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                      <strong>${{ event.donation_total|number_format(2) }}</strong>
                      {% if event.donation_count > 0 %}
                        <span class="mel-muted" style="font-size: 0.875rem;">{{ event.donation_count }} {{ 'donation'|t }}{% if event.donation_count != 1 %}s{% endif %}</span>
                      {% endif %}
                    </div>
                  {% else %}
                    <span class="mel-muted">$0.00</span>
                  {% endif %}
                </td>
                <td>
                  <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                    <a href="{{ event.edit_url }}" class="mel-btn mel-btn-small">{{ 'Edit'|t }}</a>
                    <a href="{{ event.url }}" class="mel-btn mel-btn-small mel-btn-secondary">{{ 'View'|t }}</a>
                    {% if event.rsvp_view_url %}
                      <a href="{{ event.rsvp_view_url }}" class="mel-btn mel-btn-small mel-btn-link">{{ 'View RSVPs'|t }}</a>
                    {% endif %}
                    {% if event.attendee_view_url %}
                      <a href="{{ event.attendee_view_url }}" class="mel-btn mel-btn-small mel-btn-link">{{ 'View Attendees'|t }}</a>
                    {% endif %}
                    {% if event.rsvp_export_url %}
                      <a href="{{ event.rsvp_export_url }}" class="mel-btn mel-btn-small mel-btn-link" download>{{ 'Export RSVPs CSV'|t }}</a>
                    {% endif %}
                    {% if event.attendee_export_url %}
                      <a href="{{ event.attendee_export_url }}" class="mel-btn mel-btn-small mel-btn-link" download>{{ 'Export Attendees CSV'|t }}</a>
                    {% endif %}
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  {% else %}
    <section class="mel-dashboard-section">
      <div class="mel-card mel-card--empty">
        <p>{{ 'You have no upcoming events.'|t }}</p>
        <a href="{{ path('node.add', {'node_type': 'event'}) }}" class="mel-btn mel-btn-primary">{{ 'Create Your First Event'|t }}</a>
      </div>
    </section>
  {% endif %}

  {# Past events (collapsible) #}
  {% if past_events is not empty %}
    <section class="mel-dashboard-section" aria-labelledby="past-events-title">
      <details class="mel-details">
        <summary class="mel-section-title">{{ 'Past Events'|t }} ({{ past_events|length }})</summary>
        <div class="mel-events-table">
          <table class="mel-table">
            <thead>
              <tr>
                <th>{{ 'Event'|t }}</th>
                <th>{{ 'Date'|t }}</th>
                <th>{{ 'RSVPs'|t }}</th>
                <th>{{ 'Tickets'|t }}</th>
                <th>{{ 'Revenue'|t }}</th>
                <th>{{ 'Donations'|t }}</th>
                <th>{{ 'Actions'|t }}</th>
              </tr>
            </thead>
            <tbody>
              {% for event in past_events %}
                <tr>
                  <td><a href="{{ event.url }}">{{ event.title }}</a></td>
                  <td>
                    {% if event.start_date %}
                      <time>{{ event.start_date }}</time>
                    {% else %}
                      <span class="mel-muted">{{ 'No date'|t }}</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if event.rsvp_count > 0 %}
                      <strong>{{ event.rsvp_count }}</strong>
                    {% else %}
                      <span class="mel-muted">0</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if event.attendee_count > 0 %}
                      <strong>{{ event.attendee_count }}</strong>
                    {% else %}
                      <span class="mel-muted">0</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if event.revenue > 0 %}
                      ${{ event.revenue|number_format(2) }}
                    {% else %}
                      <span class="mel-muted">$0.00</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if event.donation_total > 0 %}
                      <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                        <strong>${{ event.donation_total|number_format(2) }}</strong>
                        {% if event.donation_count > 0 %}
                          <span class="mel-muted" style="font-size: 0.875rem;">{{ event.donation_count }} {{ 'donation'|t }}{% if event.donation_count != 1 %}s{% endif %}</span>
                        {% endif %}
                      </div>
                    {% else %}
                      <span class="mel-muted">$0.00</span>
                    {% endif %}
                  </td>
                  <td>
                    <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                      <a href="{{ event.url }}" class="mel-btn mel-btn-small mel-btn-secondary">{{ 'View'|t }}</a>
                      {% if event.rsvp_view_url %}
                        <a href="{{ event.rsvp_view_url }}" class="mel-btn mel-btn-small mel-btn-link">{{ 'View RSVPs'|t }}</a>
                      {% endif %}
                      {% if event.attendee_view_url %}
                        <a href="{{ event.attendee_view_url }}" class="mel-btn mel-btn-small mel-btn-link">{{ 'View Attendees'|t }}</a>
                      {% endif %}
                      {% if event.rsvp_export_url %}
                        <a href="{{ event.rsvp_export_url }}" class="mel-btn mel-btn-small mel-btn-link" download>{{ 'Export RSVPs CSV'|t }}</a>
                      {% endif %}
                      {% if event.attendee_export_url %}
                        <a href="{{ event.attendee_export_url }}" class="mel-btn mel-btn-small mel-btn-link" download>{{ 'Export Attendees CSV'|t }}</a>
                      {% endif %}
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </details>
    </section>
  {% endif %}

</div>
